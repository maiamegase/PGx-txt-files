> load("~/Downloads/MHRA/.RData")
> library(readr)
> PREPARE_Drugs <- read_csv("PREPARE_Drugs.csv")
> View(PREPARE_Drugs)
> ADR_master$PREPARE_drugs <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$PREPARE_Drugs)
> ADR_master$CYP2C19_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2C19_PREPARE)
> ADR_master$CYP2D6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2D6_PREPARE)
> ADR_master$SLCO1B1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$SLCO1B1_PREPARE)
> ADR_master$OTHER_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$OTHER_PREPARE)
> ADR_master$DPYD_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$DPYD_PREPARE)
> ADR_master$UGT1A1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$UGT1A1_PREPARE)
> ADR_master$VKORC1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$VKORC1_PREPARE)
> ADR_master$HLA_A_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$HLA_A_PREPARE)
> ADR_master$HLA_B_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$HLA_B_PREPARE)
> ADR_master$TPMT_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$TPMT_PREPARE)
> ADR_master$CYP3A5_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP3A5_PREPARE)
> ADR_master$CYP2B6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2B6_PREPARE)
> ADR_master$CYP2C9_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2C9_PREPARE)
> ADR_master$RECVD_YEAR_1 <- as.numeric(as.character(ADR_master$RECVD_YEAR_1))
> any_na <- any(is.na(ADR_master$RECVD_YEAR_1))
> ADR_master$Decade <- (ADR_master$RECVD_YEAR_1%/%10) * 10
> install.packages("dplyr")
indexed 0B in  0s, 0B/sindexed 1.00TB in  0s, 7.40PB/s                                                                                                       
The downloaded binary packages are in
	/var/folders/md/j903sxgj1453scv9p_fqqvbr0000gn/T//RtmpMsWSOY/downloaded_packages
> library(dplyr)
> install.packages("tidyverse")

The downloaded binary packages are in
	/var/folders/md/j903sxgj1453scv9p_fqqvbr0000gn/T//RtmpMsWSOY/downloaded_packages
> library(tidyverse)
> percentage_per_gender <- ADR_master %>% group_by(Decade, SEX_1) %>% 
+ summarise(Total = n(), PREPARE = sum(PREPARE_drugs == 1)) %>% 
+ mutate(Percentage_PREPARE = (PREPARE/Total) * 100) %>% pivot_wider(names_from = SEX_1, 
+ values_from = Percentage_PREPARE) %>% mutate(Total_PREPARE = Male + 
+ Female + Unknown, Percentage_PREPARE = Total_PREPARE/Total * 
+ 100)
> percentage_non_prepare_gender <- ADR_master %>% group_by(Decade, 
+ SEX_1) %>% summarise(Total = n(), Non_PREPARE = sum(PREPARE_drugs == 
+ 0)) %>% mutate(Percentage_NON_PREPARE = (Non_PREPARE/Total) * 
+ 100) %>% pivot_wider(names_from = SEX_1, values_from = Percentage_NON_PREPARE)
> combined_data <- merge(percentage_per_gender, percentage_non_prepare_gender, 
+ by = c("Decade"))
> plot_stacked_bar <- ggplot(combined_data, aes(x = factor(Decade))) + 
+ geom_bar(aes(y = Percentage_PREPARE, fill = "PREPARE"), stat = "identity") + 
+ geom_bar(aes(y = Male + Female + Unknown, fill = "NON-PREPARE"), 
+ 
+ stat = "identity") + labs(x = "Decade", y = "Percentage", 
+ title = "Percentage of ADR Reports Associated with PREPARE Drugs by Gender and Decade") + 
+ scale_fill_manual(values = c(PREPARE = "skyblue", `NON-PREPARE` = "orange")) + 
+ theme_minimal() + theme(legend.position = "none")
> is.na(ADR_master$SEX_1)
   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
  [17] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
  [33] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
  [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
  [65] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
  [81] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
  [97] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [113] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [129] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [145] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [161] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [177] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [193] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [209] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [225] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [241] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [257] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [273] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [289] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [305] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [321] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [337] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [353] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [369] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [385] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [401] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [417] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [433] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [449] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [465] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [481] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [497] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [513] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [529] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [545] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [561] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [577] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [593] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [609] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [625] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [641] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [657] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [673] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [689] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [705] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [721] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [737] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [753] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [769] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [785] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [801] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [817] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [833] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [849] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [865] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [881] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [897] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [913] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [929] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [945] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [961] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [977] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [993] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
 [ reached getOption("max.print") -- omitted 1344712 entries ]
> any(is.na(ADR_master$SEX_1))
[1] FALSE
> any(is.na(ADR_master$AGE_10_1))
[1] TRUE
> install.packages("ggplot2")
Error in install.packages : Updating loaded packages
> install.packages("ggplot2")

The downloaded binary packages are in
	/var/folders/md/j903sxgj1453scv9p_fqqvbr0000gn/T//RtmpMsWSOY/downloaded_packages
> library(ggplot2)
> ADR_master$PREPARE_drugs <- as.numeric(as.character(ADR_master$PREPARE_drugs))
> total_counts <- ADR_master %>% group_by(SEX_1, PREPARE_drugs) %>% 
+ summarise(Total = n(), .groups = "drop") %>% mutate(Drug_Type = ifelse(PREPARE_drugs == 
+ 1, "PREPARE", "Non-PREPARE"))
> total_drug_counts <- total_counts %>% group_by(Drug_Type) %>% 
+ summarise(Overall_Total = sum(Total), .groups = "drop")
> combined_data <- total_counts %>% left_join(total_drug_counts, 
+ by = "Drug_Type") %>% mutate(Percentage = (Total/Overall_Total) * 
+ 100) %>% select(SEX_1, Drug_Type, Percentage)
> plot_stacked_bar <- ggplot(combined_data, aes(x = Drug_Type, 
+ y = Percentage, fill = SEX_1)) + geom_bar(stat = "identity", 
+ position = "stack", width = 0.4) + labs(x = "Drug Type", 
+ y = "Percentage", title = "Comparing the Percentage of PREPARE Drugs ADR Reports vs \n
+    Non-PREPARE Drugs ADR Reports by Gender") + 
+ scale_fill_manual(values = c(Male = "#8dd3c7", Female = "#ffffb3", 
+ 
+ Unknown = "#80b1d3")) + theme_minimal()
> print(plot_stacked_bar)
> print(combined_data)
# A tibble: 6 × 3
  SEX_1   Drug_Type   Percentage
  <chr>   <chr>            <dbl>
1 Female  Non-PREPARE      57.3 
2 Female  PREPARE          56.1 
3 Male    Non-PREPARE      37.9 
4 Male    PREPARE          39.6 
5 Unknown Non-PREPARE       4.77
6 Unknown PREPARE           4.33
> plot_stacked_bar <- ggplot(combined_data, aes(x = Drug_Type, 
+ y = Percentage, fill = SEX_1)) + geom_bar(stat = "identity", 
+ position = "stack", width = 0.4) + labs(x = "Drug Type", 
+ y = "Percentage of ADR Reports", title = "Comparing the Percentage of PREPARE Drugs ADR Reports vs \n
+    Non-PREPARE Drugs ADR Reports by Gender") + 
+ scale_fill_manual(values = c(Male = "#8dd3c7", Female = "#ffffb3", 
+ 
+ Unknown = "#80b1d3")) + theme_minimal()
> print(plot_stacked_bar)
> print(total_counts)
# A tibble: 6 × 4
  SEX_1   PREPARE_drugs  Total Drug_Type  
  <chr>           <dbl>  <int> <chr>      
1 Female              0 704949 Non-PREPARE
2 Female              1  64903 PREPARE    
3 Male                0 466365 Non-PREPARE
4 Male                1  45876 PREPARE    
5 Unknown             0  58609 Non-PREPARE
6 Unknown             1   5010 PREPARE    
> print(total_drug_counts)
# A tibble: 2 × 2
  Drug_Type   Overall_Total
  <chr>               <int>
1 Non-PREPARE       1229923
2 PREPARE            115789
> calculate_percentage_per_decade <- function(drug_category_column) {
+ total_reports_per_decade <- table((ADR_master$RECVD_YEAR_1%/%10) * 
+ 
+ 10)
+ drug_reports_per_decade <- table((ADR_master$RECVD_YEAR_1%/%10) * 
+ 
+ 10, drug_category_column)
+ percentage_per_decade <- (drug_reports_per_decade[, "1"]/total_reports_per_decade) * 
+ 
+ 100
+ data.frame(Decade = as.numeric(names(percentage_per_decade)), 
+ 
+ Percentage = as.numeric(percentage_per_decade))
+ }
> total_reports_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% count(Decade)
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(CYP2C19 = sum(CYP2C19_PREPARE), 
+ SLCO1B1 = sum(SLCO1B1_PREPARE), CYP2D6 = sum(CYP2D6_PREPARE), 
+ OTHER = sum(OTHER_PREPARE))
> percentage_per_gene_per_decade <- reports_per_gene_per_decade %>% 
+ left_join(total_reports_per_decade, by = "Decade") %>% mutate(CYP2C19 = (CYP2C19/n) * 
+ 100, SLCO1B1 = (SLCO1B1/n) * 100, CYP2D6 = (CYP2D6/n) * 100, 
+ OTHER = (OTHER/n) * 100) %>% select(-n) %>% pivot_longer(-Decade, 
+ names_to = "Gene", values_to = "Percentage")
> my_colors <- c("#ffffb3", "#80b1d3", "#ccebc5", "#b3de69")
> plot_stacked_bar <- ggplot(percentage_per_gene_per_decade, aes(x = factor(Decade), 
+ y = Percentage, fill = Gene)) + geom_bar(stat = "identity") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE drugs and their associated genes per Decade") + 
+ theme_minimal() + scale_fill_manual(values = my_colors)
> print(plot_stacked_bar)
> print(percentage_per_gene_per_decade)
# A tibble: 28 × 3
   Decade Gene    Percentage
    <dbl> <chr>        <dbl>
 1   1960 CYP2C19     1.02  
 2   1960 SLCO1B1     0     
 3   1960 CYP2D6      3.61  
 4   1960 OTHER       0.937 
 5   1970 CYP2C19     0.660 
 6   1970 SLCO1B1     0     
 7   1970 CYP2D6      2.57  
 8   1970 OTHER       1.15  
 9   1980 CYP2C19     0.398 
10   1980 SLCO1B1     0.0634
# ℹ 18 more rows
# ℹ Use `print(n = ...)` to see more rows
> print(reports_per_gene_per_decade)
# A tibble: 7 × 5
  Decade CYP2C19 SLCO1B1 CYP2D6 OTHER
   <dbl>   <int>   <int>  <int> <int>
1   1960     218       0    771   200
2   1970     431       0   1676   748
3   1980     527      84   2490  2156
4   1990    3489    3339  14205  2987
5   2000    5996    5135  10447  5525
6   2010    7503    5327   9986  9467
7   2020    5279    3652   6844  6282
> count_total_PREPARE_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> print(count_total_PREPARE_ADRs)
[1] 115789
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE")] == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE 
          23443           46419           17537 
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(CYP2C19 = sum(CYP2C19_PREPARE), 
+ SLCO1B1 = sum(SLCO1B1_PREPARE), CYP2D6 = sum(CYP2D6_PREPARE), 
+ OTHER = sum(OTHER_PREPARE))
> print(reports_per_gene_per_decade)
# A tibble: 7 × 5
  Decade CYP2C19 SLCO1B1 CYP2D6 OTHER
   <dbl>   <int>   <int>  <int> <int>
1   1960     218       0    771   200
2   1970     431       0   1676   748
3   1980     527      84   2490  2156
4   1990    3489    3339  14205  2987
5   2000    5996    5135  10447  5525
6   2010    7503    5327   9986  9467
7   2020    5279    3652   6844  6282
> count_total_OTHER_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> count_total_OTHER_ADRs <- sum(ADR_master$OTHER_drugs == 1)
> print(count_total_OTHER_ADRs)
[1] 0
> count_total_OTHER_ADRs <- sum(ADR_master$OTHER_PREPARE == 1)
> print(count_total_OTHER_ADRs)
[1] 27365
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           27365 
> library(readr)
> PREPARE_drugs <- read_csv("PREPARE_drugs.csv")
> View(PREPARE_drugs)
> ADR_master <- ADR_master %>% select(-c(PREPARE_drugs, CYP2C19_PREPARE, 
+ CYP2D6_PREPARE, SLCO1B1_PREPARE, OTHER_PREPARE, DPYD_PREPARE, 
+ UGT1A1_PREPARE, VKORC1_PREPARE, HLA_A_PREPARE, HLA_B_PREPARE, 
+ TPMT_PREPARE, CYP3A5_PREPARE, CYP2B6_PREPARE, CYP2C9_PREPARE, 
+ Decade))
> ADR_master$PREPARE_drugs <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$PREPARE_Drugs)
> ADR_master$CYP2C19_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2C19_PREPARE)
> ADR_master$CYP2D6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2D6_PREPARE)
> ADR_master$SLCO1B1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$SLCO1B1_PREPARE)
> ADR_master$OTHER_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$OTHER_PREPARE)
> ADR_master$DPYD_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$DPYD_PREPARE)
> ADR_master$UGT1A1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$UGT1A1_PREPARE)
> ADR_master$VKORC1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$VKORC1_PREPARE)
> ADR_master$HLA_A_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$HLA_A_PREPARE)
> ADR_master$HLA_B_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$HLA_B_PREPARE)
> ADR_master$TPMT_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_Drugs$TPMT_PREPARE)
> ADR_master$CYP3A5_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP3A5_PREPARE)
> ADR_master$CYP2B6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2B6_PREPARE)
> ADR_master$CYP2C9_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_Drugs$CYP2C9_PREPARE)
> ADR_master$Decade <- (ADR_master$RECVD_YEAR_1%/%10) * 10
> calculate_percentage_per_decade <- function(drug_category_column) {
+ total_reports_per_decade <- table((ADR_master$RECVD_YEAR_1%/%10) * 
+ 
+ 10)
+ drug_reports_per_decade <- table((ADR_master$RECVD_YEAR_1%/%10) * 
+ 
+ 10, drug_category_column)
+ percentage_per_decade <- (drug_reports_per_decade[, "1"]/total_reports_per_decade) * 
+ 
+ 100
+ data.frame(Decade = as.numeric(names(percentage_per_decade)), 
+ 
+ Percentage = as.numeric(percentage_per_decade))
+ }
> total_reports_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% count(Decade)
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(CYP2C19 = sum(CYP2C19_PREPARE), 
+ SLCO1B1 = sum(SLCO1B1_PREPARE), CYP2D6 = sum(CYP2D6_PREPARE), 
+ OTHER = sum(OTHER_PREPARE))
> percentage_per_gene_per_decade <- reports_per_gene_per_decade %>% 
+ left_join(total_reports_per_decade, by = "Decade") %>% mutate(CYP2C19 = (CYP2C19/n) * 
+ 100, SLCO1B1 = (SLCO1B1/n) * 100, CYP2D6 = (CYP2D6/n) * 100, 
+ OTHER = (OTHER/n) * 100) %>% select(-n) %>% pivot_longer(-Decade, 
+ names_to = "Gene", values_to = "Percentage")
> my_colors <- c("#ffffb3", "#80b1d3", "#ccebc5", "#b3de69")
> plot_stacked_bar <- ggplot(percentage_per_gene_per_decade, aes(x = factor(Decade), 
+ y = Percentage, fill = Gene)) + geom_bar(stat = "identity") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE drugs and their associated genes per Decade") + 
+ theme_minimal() + scale_fill_manual(values = my_colors)
> print(plot_stacked_bar)
> View(ADR_master)
> print(reports_per_gene_per_decade)
indexed 0B in  0s, 0B/sindexed 1.00TB in  0s, 3.88PB/s                                                                                                     # A tibble: 7 × 5
  Decade CYP2C19 SLCO1B1 CYP2D6 OTHER
   <dbl>   <int>   <int>  <int> <int>
1   1960     218       0    771   200
2   1970     431       0   1676   748
3   1980     527      84   2490  2156
4   1990    3489    3339  14205  2987
5   2000    5996    5135  10447  5525
6   2010    7503    5327   9986  9467
7   2020    5279    3652   6844  6282
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           27365 
> ADR_master <- ADR_master %>% select(-c(PREPARE_drugs, CYP2C19_PREPARE, 
+ CYP2D6_PREPARE, SLCO1B1_PREPARE, OTHER_PREPARE, DPYD_PREPARE, 
+ UGT1A1_PREPARE, VKORC1_PREPARE, HLA_A_PREPARE, HLA_B_PREPARE, 
+ TPMT_PREPARE, CYP3A5_PREPARE, CYP2B6_PREPARE, CYP2C9_PREPARE, 
+ Decade))
> ADR_master$PREPARE_drugs <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$PREPARE_Drugs)
> ADR_master$CYP2C19_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2C19_PREPARE)
> ADR_master$CYP2D6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2D6_PREPARE)
> ADR_master$SLCO1B1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$SLCO1B1_PREPARE)
> ADR_master$OTHER_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$OTHER_PREPARE)
> ADR_master$DPYD_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$DPYD_PREPARE)
> ADR_master$UGT1A1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$UGT1A1_PREPARE)
> ADR_master$VKORC1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$VKORC1_PREPARE)
> ADR_master$HLA_A_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$HLA_A_PREPARE)
> ADR_master$HLA_B_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$HLA_B_PREPARE)
> ADR_master$TPMT_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$TPMT_PREPARE)
> ADR_master$CYP3A5_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP3A5_PREPARE)
> ADR_master$CYP2B6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2B6_PREPARE)
> ADR_master$CYP2C9_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2C9_PREPARE)
> ADR_master$Decade <- (ADR_master$RECVD_YEAR_1%/%10) * 10
> total_reports_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% count(Decade)
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(CYP2C19 = sum(CYP2C19_PREPARE), 
+ SLCO1B1 = sum(SLCO1B1_PREPARE), CYP2D6 = sum(CYP2D6_PREPARE), 
+ OTHER = sum(OTHER_PREPARE))
> percentage_per_gene_per_decade <- reports_per_gene_per_decade %>% 
+ left_join(total_reports_per_decade, by = "Decade") %>% mutate(CYP2C19 = (CYP2C19/n) * 
+ 100, SLCO1B1 = (SLCO1B1/n) * 100, CYP2D6 = (CYP2D6/n) * 100, 
+ OTHER = (OTHER/n) * 100) %>% select(-n) %>% pivot_longer(-Decade, 
+ names_to = "Gene", values_to = "Percentage")
> my_colors <- c("#ffffb3", "#80b1d3", "#ccebc5", "#b3de69")
> plot_stacked_bar <- ggplot(percentage_per_gene_per_decade, aes(x = factor(Decade), 
+ y = Percentage, fill = Gene)) + geom_bar(stat = "identity") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE drugs and their associated genes per Decade") + 
+ theme_minimal() + scale_fill_manual(values = my_colors)
> print(plot_stacked_bar)
> print(reports_per_gene_per_decade)
# A tibble: 7 × 5
  Decade CYP2C19 SLCO1B1 CYP2D6 OTHER
   <dbl>   <int>   <int>  <int> <int>
1   1960     218       0    771   205
2   1970     431       0   1676   809
3   1980     527      84   2490  2342
4   1990    3489    3339  14205  3365
5   2000    5996    5135  10447  6240
6   2010    7503    5327   9986 10521
7   2020    5279    3652   6844  6766
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           30248 
> count_total_PREPARE_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> print(count_total_PREPARE_ADRs)
[1] 115789
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           30248 
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> count_total_PREPARE_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           30248 
> print(count_total_PREPARE_ADRs)
[1] 115789
> consistent <- all(ADR_master$PREPARE_drugs == (rowSums(ADR_master[, 
+ c("CYP2C19_PREPARE", "CYP2D6_PREPARE", "SLCO1B1_PREPARE", 
+ 
+ "OTHER_PREPARE")]) > 0))
> print(consistent)
[1] TRUE
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> count_total_PREPARE_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> print(count_total_PREPARE_ADRs)
[1] 115789
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           30248 
> table(ADR_master$CYP2C19_PREPARE)

      0       1 
1322269   23443 
> table(ADR_master$CYP2D6_PREPARE)

      0       1 
1299293   46419 
> table(ADR_master$SLCO1B1_PREPARE)

      0       1 
1328175   17537 
> table(ADR_master$OTHER_PREPARE)

      0       1 
1315464   30248 
> any(is.na(ADR_master$CYP2C19_PREPARE))
[1] FALSE
> any(is.na(ADR_master$CYP2D6_PREPARE))
[1] FALSE
> any(is.na(ADR_master$SLCO1B1_PREPARE))
[1] FALSE
> any(is.na(ADR_master$OTHER_PREPARE))
[1] FALSE
> table(ADR_master$PREPARE_drugs)

      0       1 
1229923  115789 
> any(is.na(ADR_master$PREPARE_drugs))
[1] FALSE
> ADR_master <- ADR_master %>% mutate(Calculated_PREPARE_drugs = ifelse(CYP2C19_PREPARE == 
+ 1 | CYP2D6_PREPARE == 1 | SLCO1B1_PREPARE == 1 | OTHER_PREPARE == 
+ 1, 1, 0))
> identical(ADR_master$PREPARE_drugs, ADR_master$Calculated_PREPARE_drugs)
[1] FALSE
> count_ones <- colSums(ADR_master[, c("CYP2C19_PREPARE", "CYP2D6_PREPARE", 
+ "SLCO1B1_PREPARE", "OTHER_PREPARE")] == 1)
> count_total_PREPARE_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> print(count_ones)
CYP2C19_PREPARE  CYP2D6_PREPARE SLCO1B1_PREPARE   OTHER_PREPARE 
          23443           46419           17537           30248 
> print(count_total_PREPARE_ADRs)
[1] 115789
> print(percentage_per_gene_per_decade)
# A tibble: 28 × 3
   Decade Gene    Percentage
    <dbl> <chr>        <dbl>
 1   1960 CYP2C19     1.02  
 2   1960 SLCO1B1     0     
 3   1960 CYP2D6      3.61  
 4   1960 OTHER       0.961 
 5   1970 CYP2C19     0.660 
 6   1970 SLCO1B1     0     
 7   1970 CYP2D6      2.57  
 8   1970 OTHER       1.24  
 9   1980 CYP2C19     0.398 
10   1980 SLCO1B1     0.0634
# ℹ 18 more rows
# ℹ Use `print(n = ...)` to see more rows
> print(percentage_per_gene_per_decade, n = 28)
# A tibble: 28 × 3
   Decade Gene    Percentage
    <dbl> <chr>        <dbl>
 1   1960 CYP2C19     1.02  
 2   1960 SLCO1B1     0     
 3   1960 CYP2D6      3.61  
 4   1960 OTHER       0.961 
 5   1970 CYP2C19     0.660 
 6   1970 SLCO1B1     0     
 7   1970 CYP2D6      2.57  
 8   1970 OTHER       1.24  
 9   1980 CYP2C19     0.398 
10   1980 SLCO1B1     0.0634
11   1980 CYP2D6      1.88  
12   1980 OTHER       1.77  
13   1990 CYP2C19     1.92  
14   1990 SLCO1B1     1.84  
15   1990 CYP2D6      7.82  
16   1990 OTHER       1.85  
17   2000 CYP2C19     2.61  
18   2000 SLCO1B1     2.24  
19   2000 CYP2D6      4.55  
20   2000 OTHER       2.72  
21   2010 CYP2C19     1.89  
22   2010 SLCO1B1     1.34  
23   2010 CYP2D6      2.52  
24   2010 OTHER       2.65  
25   2020 CYP2C19     1.66  
26   2020 SLCO1B1     1.15  
27   2020 CYP2D6      2.15  
28   2020 OTHER       2.13  
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(CYP2C19 = sum(CYP2C19_PREPARE), 
+ SLCO1B1 = sum(SLCO1B1_PREPARE), CYP2D6 = sum(CYP2D6_PREPARE), 
+ OTHER = sum(OTHER_PREPARE))
> percentage_per_gene_per_decade <- reports_per_gene_per_decade %>% 
+ left_join(total_reports_per_decade, by = "Decade") %>% mutate(CYP2C19 = (CYP2C19/n) * 
+ 100, SLCO1B1 = (SLCO1B1/n) * 100, CYP2D6 = (CYP2D6/n) * 100, 
+ OTHER = (OTHER/n) * 100) %>% select(-n) %>% pivot_longer(-Decade, 
+ names_to = "Gene", values_to = "Percentage")
> my_colors <- c("#ffffb3", "#80b1d3", "#ccebc5", "#b3de69")
> plot_stacked_bar <- ggplot(percentage_per_gene_per_decade, aes(x = factor(Decade), 
+ y = Percentage, fill = Gene)) + geom_bar(stat = "identity") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE drugs \n
+    and their associated genes per Decade") + 
+ theme_minimal() + scale_fill_manual(values = my_colors)
> print(plot_stacked_bar)
> plot_stacked_bar <- ggplot(percentage_per_gene_per_decade, aes(x = factor(Decade), 
+ y = Percentage, fill = Gene)) + geom_bar(stat = "identity") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE \n
+   Drugs and Their Associated Genes Per Decade") + 
+ theme_minimal() + scale_fill_manual(values = my_colors)
> print(plot_stacked_bar)
> total_reports_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% count(Decade)
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(CYP2C19 = sum(CYP2C19_PREPARE), 
+ SLCO1B1 = sum(SLCO1B1_PREPARE), CYP2D6 = sum(CYP2D6_PREPARE), 
+ DPYD = sum(DPYD_PREPARE), UGT1A1 = sum(UGT1A1_PREPARE), VKORC1 = sum(VKORC1_PREPARE), 
+ HLA_A = sum(HLA_A_PREPARE), HLA_B = sum(HLA_B_PREPARE), TPMT = sum(TPMT_PREPARE), 
+ CYP3A5 = sum(CYP3A5_PREPARE), CYP2B6 = sum(CYP2B6_PREPARE), 
+ CYP2C9 = sum(CYP2C9_PREPARE))
> percentage_per_gene_per_decade <- reports_per_gene_per_decade %>% 
+ left_join(total_reports_per_decade, by = "Decade") %>% mutate(CYP2C19 = (CYP2C19/n) * 
+ 100, SLCO1B1 = (SLCO1B1/n) * 100, CYP2D6 = (CYP2D6/n) * 100, 
+ DPYD = (DPYD/n) * 100, UGT1A1 = (UGT1A1/n) * 100, VKORC1 = (VKORC1/n) * 
+ 
+ 100, HLA_A = (HLA_A/n) * 100, HLA_B = (HLA_B/n) * 100, 
+ TPMT = (TPMT/n) * 100, CYP3A5 = (CYP3A5/n) * 100, CYP2B6 = (CYP2B6/n) * 
+ 
+ 100, CYP2C9 = (CYP2C9/n) * 100) %>% select(-n) %>% pivot_longer(-Decade, 
+ names_to = "Gene", values_to = "Percentage")
> my_colors <- c("#8dd3c7", "#ffffb3", "#bebada", "#80b1d3", "#fdb462", 
+ "#b3de69", "#fccde5", "#d9d9d9", "#bc80bd", "#ccebc5", "#ffed6f", 
+ "#a6cee3")
> plot_stacked_bar <- ggplot(percentage_per_gene_per_decade, aes(x = factor(Decade), 
+ y = Percentage, fill = Gene)) + geom_bar(stat = "identity") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE drugs and their associated genes per Decade") + 
+ theme_minimal() + scale_fill_manual(values = my_colors)
> print(plot_stacked_bar)
> print(total_reports_per_decade)
  Decade      n
1   1960  21341
2   1970  65318
3   1980 132500
4   1990 181754
5   2000 229721
6   2010 396779
7   2020 318299
> print(reports_per_gene_per_decade)
# A tibble: 7 × 13
  Decade CYP2C19 SLCO1B1 CYP2D6  DPYD UGT1A1 VKORC1 HLA_A HLA_B  TPMT CYP3A5 CYP2B6 CYP2C9
   <dbl>   <int>   <int>  <int> <int>  <int>  <int> <int> <int> <int>  <int>  <int>  <int>
1   1960     218       0    771     1      0     28   126   126     5      0      0     73
2   1970     431       0   1676    20      0    189   282   347    68      0      0    374
3   1980     527      84   2490    28      0    193  1405  1581   198      0      0    535
4   1990    3489    3339  14205    77     40    600  1363  1760   400     71     77    940
5   2000    5996    5135  10447   785    107   1406  1333  1810   801    451    382   1904
6   2010    7503    5327   9986  1243    148   2023  1333  3874  1269   1131    370   2486
7   2020    5279    3652   6844   794     98    730   689  3226   545   1076    124    903
> print(percentage_per_gene_per_decade)
# A tibble: 84 × 3
   Decade Gene    Percentage
    <dbl> <chr>        <dbl>
 1   1960 CYP2C19    1.02   
 2   1960 SLCO1B1    0      
 3   1960 CYP2D6     3.61   
 4   1960 DPYD       0.00469
 5   1960 UGT1A1     0      
 6   1960 VKORC1     0.131  
 7   1960 HLA_A      0.590  
 8   1960 HLA_B      0.590  
 9   1960 TPMT       0.0234 
10   1960 CYP3A5     0      
# ℹ 74 more rows
# ℹ Use `print(n = ...)` to see more rows
> print(percentage_per_gene_per_decade, n = 84)
# A tibble: 84 × 3
   Decade Gene    Percentage
    <dbl> <chr>        <dbl>
 1   1960 CYP2C19    1.02   
 2   1960 SLCO1B1    0      
 3   1960 CYP2D6     3.61   
 4   1960 DPYD       0.00469
 5   1960 UGT1A1     0      
 6   1960 VKORC1     0.131  
 7   1960 HLA_A      0.590  
 8   1960 HLA_B      0.590  
 9   1960 TPMT       0.0234 
10   1960 CYP3A5     0      
11   1960 CYP2B6     0      
12   1960 CYP2C9     0.342  
13   1970 CYP2C19    0.660  
14   1970 SLCO1B1    0      
15   1970 CYP2D6     2.57   
16   1970 DPYD       0.0306 
17   1970 UGT1A1     0      
18   1970 VKORC1     0.289  
19   1970 HLA_A      0.432  
20   1970 HLA_B      0.531  
21   1970 TPMT       0.104  
22   1970 CYP3A5     0      
23   1970 CYP2B6     0      
24   1970 CYP2C9     0.573  
25   1980 CYP2C19    0.398  
26   1980 SLCO1B1    0.0634 
27   1980 CYP2D6     1.88   
28   1980 DPYD       0.0211 
29   1980 UGT1A1     0      
30   1980 VKORC1     0.146  
31   1980 HLA_A      1.06   
32   1980 HLA_B      1.19   
33   1980 TPMT       0.149  
34   1980 CYP3A5     0      
35   1980 CYP2B6     0      
36   1980 CYP2C9     0.404  
37   1990 CYP2C19    1.92   
38   1990 SLCO1B1    1.84   
39   1990 CYP2D6     7.82   
40   1990 DPYD       0.0424 
41   1990 UGT1A1     0.0220 
42   1990 VKORC1     0.330  
43   1990 HLA_A      0.750  
44   1990 HLA_B      0.968  
45   1990 TPMT       0.220  
46   1990 CYP3A5     0.0391 
47   1990 CYP2B6     0.0424 
48   1990 CYP2C9     0.517  
49   2000 CYP2C19    2.61   
50   2000 SLCO1B1    2.24   
51   2000 CYP2D6     4.55   
52   2000 DPYD       0.342  
53   2000 UGT1A1     0.0466 
54   2000 VKORC1     0.612  
55   2000 HLA_A      0.580  
56   2000 HLA_B      0.788  
57   2000 TPMT       0.349  
58   2000 CYP3A5     0.196  
59   2000 CYP2B6     0.166  
60   2000 CYP2C9     0.829  
61   2010 CYP2C19    1.89   
62   2010 SLCO1B1    1.34   
63   2010 CYP2D6     2.52   
64   2010 DPYD       0.313  
65   2010 UGT1A1     0.0373 
66   2010 VKORC1     0.510  
67   2010 HLA_A      0.336  
68   2010 HLA_B      0.976  
69   2010 TPMT       0.320  
70   2010 CYP3A5     0.285  
71   2010 CYP2B6     0.0933 
72   2010 CYP2C9     0.627  
73   2020 CYP2C19    1.66   
74   2020 SLCO1B1    1.15   
75   2020 CYP2D6     2.15   
76   2020 DPYD       0.249  
77   2020 UGT1A1     0.0308 
78   2020 VKORC1     0.229  
79   2020 HLA_A      0.216  
80   2020 HLA_B      1.01   
81   2020 TPMT       0.171  
82   2020 CYP3A5     0.338  
83   2020 CYP2B6     0.0390 
84   2020 CYP2C9     0.284  
> percentage_per_gene_per_decade <- reports_per_gene_per_decade %>% 
+ left_join(total_reports_per_decade, by = "Decade") %>% mutate(CYP2C19 = (CYP2C19/n) * 
+ 100, SLCO1B1 = (SLCO1B1/n) * 100, CYP2D6 = (CYP2D6/n) * 100, 
+ DPYD = (DPYD/n) * 100, UGT1A1 = (UGT1A1/n) * 100, VKORC1 = (VKORC1/n) * 
+ 
+ 100, HLA_A = (HLA_A/n) * 100, HLA_B = (HLA_B/n) * 100, 
+ TPMT = (TPMT/n) * 100, CYP3A5 = (CYP3A5/n) * 100, CYP2B6 = (CYP2B6/n) * 
+ 
+ 100, CYP2C9 = (CYP2C9/n) * 100) %>% select(-n) %>% pivot_longer(-Decade, 
+ names_to = "Gene", values_to = "Percentage")
> print(percentage_per_gene_per_decade)
# A tibble: 84 × 3
   Decade Gene    Percentage
    <dbl> <chr>        <dbl>
 1   1960 CYP2C19    1.02   
 2   1960 SLCO1B1    0      
 3   1960 CYP2D6     3.61   
 4   1960 DPYD       0.00469
 5   1960 UGT1A1     0      
 6   1960 VKORC1     0.131  
 7   1960 HLA_A      0.590  
 8   1960 HLA_B      0.590  
 9   1960 TPMT       0.0234 
10   1960 CYP3A5     0      
# ℹ 74 more rows
# ℹ Use `print(n = ...)` to see more rows
> write.csv(percentage_per_gene_per_decade, file = "percentage_per_gene_per_decade.csv", 
+ row.names = FALSE)
> percentage_per_decade <- ADR_master %>% group_by(Decade) %>% 
+ summarise(Total = n(), PREPARE = sum(PREPARE_drugs == 1)) %>% 
+ mutate(Percentage_PREPARE = (PREPARE/Total) * 100)
> plot_prepare_overall <- ggplot(percentage_per_decade, aes(x = factor(Decade), 
+ y = Percentage_PREPARE)) + geom_bar(stat = "identity", fill = "skyblue") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE Drugs per Decade") + 
+ theme_minimal()
> print(plot_prepare_overall)
> percentage_per_decade <- ADR_master %>% group_by(Decade) %>% 
+ summarise(Total = n(), CYP2D6 = sum(CYP2D6_PREPARE == 1)) %>% 
+ mutate(Percentage_CYP2D6 = (CYP2D6/Total) * 100)
> plot_prepare_overall <- ggplot(percentage_per_decade, aes(x = factor(Decade), 
+ y = Percentage_PREPARE)) + geom_bar(stat = "identity", fill = "skyblue") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE Drugs per Decade") + 
+ theme_minimal()
> plot_prepare_overall <- ggplot(percentage_per_decade, aes(x = factor(Decade), 
+ y = Percentage_CYP2D6)) + geom_bar(stat = "identity", fill = "skyblue") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with PREPARE Drugs per Decade") + 
+ theme_minimal()
> print(plot_prepare_overall)
> total_reports_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% count(Decade)
> plot_prepare_overall <- ggplot(percentage_per_decade, aes(x = factor(Decade), 
+ y = Percentage_PREPARE)) + geom_bar(stat = "identity", fill = "skyblue") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with CYP2D6 Drugs per Decade") + 
+ theme_minimal()
> plot_prepare_overall <- ggplot(percentage_per_decade, aes(x = factor(Decade), 
+ y = Percentage_CYP2D6)) + geom_bar(stat = "identity", fill = "skyblue") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with CYP2D6 Drugs per Decade") + 
+ theme_minimal()
> print(plot_prepare_overall)
> percentage_per_decade_CYP2D6 <- ADR_master %>% group_by(Decade) %>% 
+ summarise(Total = n(), CYP2D6 = sum(CYP2D6_PREPARE == 1)) %>% 
+ mutate(Percentage_CYP2D6 = (CYP2D6/Total) * 100)
> plot_prepare_CYP2D6 <- ggplot(percentage_per_decade_CYP2D6, aes(x = factor(Decade), 
+ y = Percentage_CYP2D6)) + geom_bar(stat = "identity", fill = "skyblue") + 
+ labs(x = "Decade", y = "Percentage", title = "Percentage of ADR Reports Associated with CYP2D6 Drugs per Decade") + 
+ theme_minimal()
> print(plot_prepare_CYP2D6)
> plot_prepare_CYP2D6_stacked <- ggplot(percentage_per_decade_CYP2D6, 
+ aes(x = factor(Decade), y = Percentage_CYP2D6, fill = Drug)) + 
+ geom_bar(stat = "identity") + labs(x = "Decade", y = "Percentage", 
+ title = "Percentage of ADR Reports Associated with CYP2D6 Drugs per Decade") + 
+ theme_minimal()
> CYP2D6_drugs <- PREPARE_drugs$CYP2D6_PREPARE
> ADR_master <- ADR_master %>% mutate(CYP2D6_PREPARE = ifelse(DRUG %in% 
+ CYP2D6_drugs, DRUG, NA))
> CYP2D6_drugs <- PREPARE_drugs$CYP2D6_PREPARE
> ADR_master$CYP2D6_PREPARE <- ifelse(ADR_master$DRUG %in% CYP2D6_drugs, 
+ ADR_master$DRUG, NA)
> ADR_master <- subset(ADR_master, select = -DRUG)
> View(ADR_master)
> load("~/Downloads/MHRA/.RData")
> View(ADR_master)
> ADR_master$PREPARE_drugs <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$PREPARE_Drugs)
> ADR_master$CYP2C19_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2C19_PREPARE)
> ADR_master$CYP2D6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2D6_PREPARE)
> ADR_master$SLCO1B1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$SLCO1B1_PREPARE)
> ADR_master$OTHER_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$OTHER_PREPARE)
> ADR_master$DPYD_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$DPYD_PREPARE)
> ADR_master$UGT1A1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$UGT1A1_PREPARE)
> ADR_master$VKORC1_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$VKORC1_PREPARE)
> ADR_master$HLA_A_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$HLA_A_PREPARE)
> ADR_master$HLA_B_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$HLA_B_PREPARE)
> ADR_master$TPMT_PREPARE <- as.integer(ADR_master$DRUG %in% PREPARE_drugs$TPMT_PREPARE)
> ADR_master$CYP3A5_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP3A5_PREPARE)
> ADR_master$CYP2B6_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2B6_PREPARE)
> ADR_master$CYP2C9_PREPARE <- as.integer(ADR_master$DRUG %in% 
+ PREPARE_drugs$CYP2C9_PREPARE)
> ADR_master$RECVD_YEAR_1 <- as.numeric(as.character(ADR_master$RECVD_YEAR_1))
> ADR_master$Decade <- (ADR_master$RECVD_YEAR_1%/%10) * 10
> CYP2D6 <- PREPARE_drugs$CYP2D6_PREPARE
> ADR_master$CYP2D6_PREPARE <- ifelse(ADR_master$DRUG %in% CYP2D6, 
+ ADR_master$DRUG, NA)
> ADR_master$CYP2D6_drugs <- ifelse(ADR_master$DRUG %in% CYP2D6, 
+ ADR_master$DRUG, NA)
> sum(ADR_master$CYP2D6_drugs == "AMITRIPTYLINE")
[1] NA
> sum(ADR_master$CYP2D6_drugs == "PAROXETINE")
[1] NA
> sum(is.na(ADR_master$CYP2D6_drugs))
[1] 1299293
> sum(ADR_master$CYP2D6_drugs == "PAROXETINE")
[1] NA
> count_total_PREPARE_ADRs <- sum(ADR_master$PREPARE_drugs == 1)
> print(count_total_PREPARE_ADRs)
[1] 115789
> ADR_master <- subset(ADR_master, select = -CYP2D6_drugs)
> ADR_master$CYP2D6_drugs <- ifelse(ADR_master$DRUG %in% CYP2D6, 
+ ADR_master$DRUG, "no")
> sum(ADR_master$CYP2D6_drugs == "PAROXETINE")
[1] 11165
> sum(ADR_master$CYP2D6_drugs == "PIMOZIDE")
[1] 184
> reports_per_gene_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(AMITRIPTYLINE = sum(ADR_master$CYP2D6_drugs == 
+ "AMITRIPTYLINE"), ARIPIPRAZOLE = sum(ADR_master$CYP2D6_drugs == 
+ "ARIPIPRAZOLE"), ATOMOXETINE = sum(ADR_master$CYP2D6_drugs == 
+ "ATOMOXETINE"), CLOMIPRAMINE = sum(ADR_master$CYP2D6_drugs == 
+ "CLOMIPRAMINE"))
> print(reports_per_gene_per_decade)
# A tibble: 7 × 5
  Decade AMITRIPTYLINE ARIPIPRAZOLE ATOMOXETINE CLOMIPRAMINE
   <dbl>         <int>        <int>       <int>        <int>
1   1960          3859         3276        1082         1101
2   1970          3859         3276        1082         1101
3   1980          3859         3276        1082         1101
4   1990          3859         3276        1082         1101
5   2000          3859         3276        1082         1101
6   2010          3859         3276        1082         1101
7   2020          3859         3276        1082         1101
> total_reports_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% count(Decade)
> reports_per_CYP2D6_drug_per_decade <- ADR_master %>% mutate(Decade = (RECVD_YEAR_1%/%10) * 
+ 10) %>% group_by(Decade) %>% summarise(AMITRIPTYLINE = sum(ADR_master$CYP2D6_drugs == 
+ "AMITRIPTYLINE"), ARIPIPRAZOLE = sum(ADR_master$CYP2D6_drugs == 
+ "ARIPIPRAZOLE"), ATOMOXETINE = sum(ADR_master$CYP2D6_drugs == 
+ "ATOMOXETINE"), CLOMIPRAMINE = sum(ADR_master$CYP2D6_drugs == 
+ "CLOMIPRAMINE"))
> print(reports_per_CYP2D6_drug_per_decade)
# A tibble: 7 × 5
  Decade AMITRIPTYLINE ARIPIPRAZOLE ATOMOXETINE CLOMIPRAMINE
   <dbl>         <int>        <int>       <int>        <int>
1   1960          3859         3276        1082         1101
2   1970          3859         3276        1082         1101
3   1980          3859         3276        1082         1101
4   1990          3859         3276        1082         1101
5   2000          3859         3276        1082         1101
6   2010          3859         3276        1082         1101
7   2020          3859         3276        1082         1101
